{
  "data": "# 核心工作流程\n\n## 1. 工作流程概览 (Workflow Overview)\n\n### 系统主干工作流程\n\n占卜应用的核心工作流程是一个以用户为中心的多模块导航系统，通过底部导航栏实现占卜、风水、社区和个人中心四大功能模块的无缝切换。系统采用React状态管理机制，通过App组件统一控制页面渲染和导航状态。\n\n```mermaid\ngraph TD\n    A[用户打开应用] --> B[App组件初始化]\n    B --> C[渲染底部导航栏]\n    C --> D[用户选择功能模块]\n    D --> E{模块选择}\n    E -->|占卜| F[DivinationPage渲染]\n    E -->|风水| G[FengShuiPage渲染]\n    E -->|社区| H[CommunityPage渲染]\n    E -->|个人中心| I[ProfilePage渲染]\n    F --> J[用户使用占卜服务]\n    G --> K[用户使用风水服务]\n    H --> L[用户浏览社区内容]\n    I --> M[用户查看个人信息]\n    J --> C\n    K --> C\n    L --> C\n    M --> C\n```\n\n### 核心执行路径\n\n系统的核心执行路径包括：\n1. **应用启动路径**：main.tsx → App.tsx → 页面渲染\n2. **导航切换路径**：底部导航点击 → 状态更新 → 页面切换\n3. **业务功能路径**：页面加载 → 数据展示 → 用户交互 → 结果反馈\n\n### 关键流程节点\n\n- **App组件**：应用主入口，负责导航状态管理和页面渲染\n- **DivinationPage**：占卜功能核心，处理星座选择和运势展示\n- **FengShuiPage**：风水功能核心，处理方位选择和建议展示\n- **CommunityPage**：社区功能核心，处理动态展示和达人咨询\n- **ProfilePage**：个人中心核心，处理用户信息和设置管理\n\n### 流程协调机制\n\n系统采用React状态管理机制实现模块间协调，通过App组件的`currentPage`状态统一控制页面切换，各页面组件独立处理自身业务逻辑，形成清晰的职责分离架构。\n\n## 2. 主要工作流程 (Main Workflows)\n\n### 2.1 应用导航流程\n\n应用导航流程是系统的核心流程，负责用户在不同功能模块间的切换和导航管理。\n\n```mermaid\nsequenceDiagram\n    participant User as 用户\n    participant App as App组件\n    participant Divination as 占卜页面\n    participant FengShui as 风水页面\n    participant Community as 社区页面\n    participant Profile as 个人中心页面\n\n    User->>App: 点击底部导航栏\n    App->>App: 更新currentPage状态\n    App->>Divination: 渲染占卜页面\n    Divination->>User: 显示占卜功能\n    User->>App: 点击风水导航\n    App->>App: 更新currentPage状态\n    App->>FengShui: 渲染风水页面\n    FengShui->>User: 显示风水功能\n    User->>App: 点击社区导航\n    App->>App: 更新currentPage状态\n    App->>Community: 渲染社区页面\n    Community->>User: 显示社区功能\n    User->>App: 点击个人中心导航\n    App->>App: 更新currentPage状态\n    App->>Profile: 渲染个人中心页面\n    Profile->>User: 显示个人中心功能\n```\n\n**流程执行顺序和依赖**：\n1. App组件初始化，设置默认页面状态\n2. 渲染底部导航栏和默认页面\n3. 监听导航点击事件，更新页面状态\n4. 根据状态渲染对应页面组件\n5. 页面组件独立处理业务逻辑\n\n**输入输出数据流转**：\n- 输入：用户导航点击事件\n- 处理：currentPage状态更新\n- 输出：对应页面组件渲染\n\n### 2.2 占卜服务流程\n\n占卜服务流程提供星座运势和卡牌占卜功能，是应用的核心业务流程之一。\n\n```mermaid\ngraph TD\n    A[用户进入占卜页面] --> B[显示星座选择器]\n    B --> C[用户选择星座]\n    C --> D[展示今日运势信息]\n    D --> E[显示占卜卡牌网格]\n    E --> F{用户操作}\n    F -->|查看运势| G[显示详细运势]\n    F -->|进行占卜| H[选择占卜卡牌]\n    G --> I[返回占卜页面]\n    H --> J[显示占卜结果]\n    J --> I\n    I --> K{继续操作}\n    K -->|星座切换| B\n    K -->|其他功能| L[返回主页面]\n```\n\n**关键业务逻辑**：\n- 星座选择器：提供多个星座选项供用户选择\n- 运势展示：显示综合评分和健康、爱情、事业、财富四个维度\n- 占卜卡牌：提供多种占卜服务入口\n- 神秘之书：提供额外的占卜功能\n\n### 2.3 风水咨询流程\n\n风水咨询流程提供方位运势和家居建议功能，帮助用户了解风水知识。\n\n```mermaid\ngraph TD\n    A[用户进入风水页面] --> B[显示罗盘图像]\n    B --> C[显示八方位按钮]\n    C --> D[用户选择方位]\n    D --> E[显示该方位信息]\n    E --> F[展示五行属性]\n    F --> G[提供风水建议]\n    G --> H{用户操作}\n    H -->|选择其他方位| I[返回选择方位]\n    H -->|返回| J[退出风水页面]\n    I --> D\n    J --> A\n```\n\n**业务流程特点**：\n- 罗盘展示：直观显示风水方位\n- 八方位系统：北、东北、东、东南、南、西南、西、西北\n- 五行属性：展示各方位的五行特征\n- 风水建议：提供具体的家居布局建议\n\n### 2.4 社区互动流程\n\n社区互动流程提供社区动态和达人咨询功能，促进用户交流。\n\n```mermaid\ngraph TD\n    A[用户进入社区页面] --> B[显示标签页切换器]\n    B --> C{选择标签页}\n    C -->|社区动态| D[展示热门话题列表]\n    C -->|达人咨询| E[展示达人列表]\n    D --> F[用户浏览帖子]\n    E --> G[用户查看达人信息]\n    F --> H{用户操作}\n    G --> I{用户操作}\n    H -->|查看帖子| J[进入帖子详情]\n    H -->|返回| K[返回社区页面]\n    I -->|发起咨询| L[进入咨询页面]\n    I -->|返回| K\n    J --> K\n    L --> K\n```\n\n**功能模块**：\n- 社区动态：展示热门话题和用户帖子\n- 达人咨询：提供专业风水占卜师咨询服务\n- 互动功能：支持用户评论、点赞等社交功能\n\n### 2.5 个人中心流程\n\n个人中心流程管理用户信息、统计数据和系统设置。\n\n```mermaid\ngraph TD\n    A[用户进入个人中心] --> B[显示用户信息]\n    B --> C[展示统计数据]\n    C --> D[显示成就系统]\n    D --> E[显示功能菜单]\n    E --> F{用户操作}\n    F -->|查看成就| G[浏览成就列表]\n    F -->|系统设置| H[进入设置页面]\n    F -->|退出登录| I[确认退出]\n    F -->|其他功能| J[进入相应功能]\n    G --> K[返回个人中心]\n    H --> K\n    I --> L[退出应用]\n    J --> K\n    K --> A\n```\n\n**核心功能**：\n- 用户信息：展示头像、等级、经验值\n- 统计数据：显示占卜次数、学习天数、获得勋章\n- 成就系统：展示已解锁和未解锁的成就\n- 功能菜单：提供收藏、学习记录、消息通知等设置\n\n## 3. 流程协调与控制 (Flow Coordination)\n\n### 3.1 多模块协调机制\n\n系统采用React Context和状态管理机制实现多模块协调：\n\n```mermaid\ngraph LR\n    A[App组件] --> B[导航状态管理]\n    A --> C[页面渲染控制]\n    B --> D[占卜页面]\n    B --> E[风水页面]\n    B --> F[社区页面]\n    B --> G[个人中心页面]\n    D --> H[UI组件库]\n    E --> H\n    F --> H\n    G --> H\n```\n\n**协调机制特点**：\n- **统一状态管理**：App组件统一管理导航状态\n- **模块独立性**：各页面组件独立处理业务逻辑\n- **组件复用**：UI组件库提供统一的组件支持\n- **数据隔离**：各模块数据相互独立，避免耦合\n\n### 3.2 状态管理和同步\n\n系统状态管理采用React Hooks机制：\n\n```mermaid\nstateDiagram-v2\n    [*] --> Initial: 应用启动\n    Initial --> NavigationState: 设置默认页面\n    NavigationState --> DivinationPage: 点击占卜导航\n    NavigationState --> FengShuiPage: 点击风水导航\n    NavigationState --> CommunityPage: 点击社区导航\n    NavigationState --> ProfilePage: 点击个人中心导航\n    DivinationPage --> NavigationState: 返回导航\n    FengShuiPage --> NavigationState: 返回导航\n    CommunityPage --> NavigationState: 返回导航\n    ProfilePage --> NavigationState: 返回导航\n    NavigationState --> [*]: 应用退出\n```\n\n**状态管理策略**：\n- **全局状态**：导航状态存储在App组件中\n- **局部状态**：各页面组件管理自身业务状态\n- **状态同步**：通过props传递状态变化\n- **生命周期管理**：组件挂载和卸载时清理状态\n\n### 3.3 数据传递和共享\n\n系统采用多种数据传递机制：\n\n1. **Props传递**：父组件向子组件传递数据\n2. **Context共享**：跨层级组件数据共享\n3. **状态提升**：共享状态提升到共同父组件\n4. **事件回调**：子组件向父组件传递数据\n\n### 3.4 执行控制和调度\n\n系统执行控制机制包括：\n\n- **渲染控制**：根据状态条件渲染不同组件\n- **事件处理**：统一处理用户交互事件\n- **生命周期管理**：组件创建、更新、销毁的控制\n- **性能优化**：使用React.memo等优化渲染性能\n\n## 4. 异常处理与恢复 (Exception Handling)\n\n### 4.1 错误检测和处理\n\n系统在多个层面实现错误检测和处理：\n\n```mermaid\ngraph TD\n    A[错误发生] --> B{错误类型}\n    B -->|组件渲染错误| C[React Error Boundary]\n    B -->|网络请求错误| D[网络错误处理]\n    B -->|数据加载错误| E[数据错误处理]\n    B -->|用户操作错误| F[用户输入验证]\n    C --> G[错误页面显示]\n    D --> H[重试机制]\n    E --> I[默认数据展示]\n    F --> J[错误提示显示]\n    G --> K[错误日志记录]\n    H --> L[成功后恢复]\n    I --> M[用户友好提示]\n    J --> N[操作指导]\n```\n\n**错误处理策略**：\n- **ImageWithFallback组件**：处理图片加载失败，显示占位图\n- **表单验证**：使用Form组件提供输入验证和错误提示\n- **错误边界**：捕获组件渲染错误，防止应用崩溃\n\n### 4.2 异常恢复机制\n\n系统提供多种异常恢复机制：\n\n1. **自动重试**：网络请求失败时自动重试\n2. **降级显示**：关键数据加载失败时显示默认内容\n3. **状态重置**：异常后重置组件到安全状态\n4. **用户引导**：提供清晰的错误信息和操作指导\n\n### 4.3 容错策略设计\n\n**前端容错策略**：\n- **优雅降级**：在功能不可用时提供替代方案\n- **渐进增强**：基础功能优先，增强功能可选\n- **数据缓存**：缓存重要数据，减少网络依赖\n- **离线支持**：提供基础功能的离线使用\n\n### 4.4 失败重试和降级\n\n系统在UI组件层面实现容错机制：\n\n- **图片组件**：ImageWithFallback提供图片加载失败的降级方案\n- **加载状态**：使用Skeleton组件提供加载状态的视觉反馈\n- **错误状态**：Alert组件提供错误信息的统一展示\n\n## 5. 关键流程实现 (Key Process Implementation)\n\n### 5.1 核心算法流程\n\n#### 5.1.1 页面渲染算法\n\nApp组件的页面渲染采用条件渲染算法：\n\n```mermaid\nflowchart TD\n    A[App组件渲染] --> B{currentPage状态}\n    B -->|divination| C[渲染DivinationPage]\n    B -->|fengshui| D[渲染FengShuiPage]\n    B -->|community| E[渲染CommunityPage]\n    B -->|profile| F[渲染ProfilePage]\n    C --> G[占卜页面业务逻辑]\n    D --> H[风水页面业务逻辑]\n    E --> I[社区页面业务逻辑]\n    F --> J[个人中心业务逻辑]\n    G --> K[返回App组件]\n    H --> K\n    I --> K\n    J --> K\n```\n\n**算法特点**：\n- **状态驱动**：根据currentPage状态决定渲染哪个页面\n- **条件渲染**：使用JavaScript条件语句实现页面切换\n- **组件复用**：各页面组件独立实现，提高代码复用性\n\n#### 5.1.2 导航状态管理算法\n\n导航状态管理采用React状态管理算法：\n\n```typescript\n// 伪代码示例\nconst [currentPage, setCurrentPage] = useState('divination');\n\nconst handleNavigation = (page: string) => {\n  setCurrentPage(page);\n  // 记录导航历史\n  // 更新UI状态\n};\n```\n\n### 5.2 数据处理管道\n\n系统数据处理管道包括：\n\n1. **数据获取**：从组件props或外部API获取数据\n2. **数据转换**：将原始数据转换为UI展示格式\n3. **数据验证**：验证数据完整性和有效性\n4. **数据渲染**：将处理后的数据渲染到UI组件\n\n### 5.3 业务规则执行\n\n#### 5.3.1 占卜业务规则\n\n占卜页面的业务规则包括：\n- 星座选择逻辑：用户可选择不同星座查看运势\n- 运势计算：根据星座和时间计算运势数据\n- 卡牌占卜：提供多种占卜服务选项\n- 结果展示：以可视化方式展示占卜结果\n\n#### 5.3.2 风水业务规则\n\n风水页面的业务规则包括：\n- 方位识别：根据用户选择显示对应方位信息\n- 五行匹配：将方位与五行属性关联\n- 风水建议：基于方位和五行提供布局建议\n- 罗盘展示：直观显示风水方位关系\n\n### 5.4 技术实现细节\n\n#### 5.4.1 UI组件架构\n\n系统采用基于Radix UI的组件架构：\n\n```mermaid\ngraph TD\n    A[Radix UI Primitives] --> B[基础组件封装]\n    B --> C[业务组件构建]\n    C --> D[页面组件组合]\n    D --> E[应用整体]\n    \n    B --> F[Button组件]\n    B --> G[Card组件]\n    B --> H[Input组件]\n    B --> I[Dialog组件]\n    \n    F --> J[占卜页面使用]\n    G --> J\n    H --> J\n    I --> J\n```\n\n**组件架构特点**：\n- **基础组件**：基于Radix UI构建，提供无障碍支持\n- **业务组件**：封装业务逻辑，提供特定功能\n- **页面组件**：组合基础组件，实现完整功能\n- **应用层级**：统一管理页面状态和导航\n\n#### 5.4.2 样式系统实现\n\n系统采用Tailwind CSS + CVA（Class Variance Authority）的样式系统：\n\n- **基础样式**：使用Tailwind CSS提供原子化样式\n- **组件样式**：使用CVA管理组件变体和状态\n- **主题系统**：支持深色/浅色主题切换\n- **响应式设计**：适配不同屏幕尺寸\n\n#### 5.4.3 性能优化策略\n\n**渲染优化**：\n- 使用React.memo避免不必要的组件重渲染\n- 实现虚拟滚动处理大量数据\n- 使用懒加载减少初始加载时间\n\n**资源优化**：\n- 图片懒加载和WebP格式支持\n- 代码分割和按需加载\n- 资源压缩和缓存策略\n\n**用户体验优化**：\n- 骨架屏提供加载状态反馈\n- 平滑动画提升交互体验\n- 预加载关键资源\n\n通过以上详细的工作流程分析，占卜应用的核心工作流程展现了清晰的架构设计和完善的业务逻辑实现，为用户提供流畅的占卜、风水、社区和个性化服务体验。",
  "timestamp": 1763520052,
  "prompt_hash": "40061565ea968376c7d53508a2e7489a",
  "token_usage": {
    "input_tokens": 13129,
    "output_tokens": 3428,
    "total_tokens": 16557
  },
  "model_name": null
}